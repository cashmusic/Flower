var FlowerMoviebox=new Class({Extends:FlowerOverlay,Implements:[Options,Events],options:{caption:"",movieObjectID:"moviebox"+$random(10000,99999),showcontrols:"false"},initialize:function(a){this.name="moviebox";this.version=1.3;this.donotdebugoptions=false;this.currentMovie=null;this.movieurl=null;this.flower_utility=flowerUID.getModule("utility");this.state=0;this.setOptions(a);this.renderboxheight=this.options.boxheight;this.renderboxwidth=this.options.boxwidth;this.flashDetected=this.flower_utility.detectPluginOrAxo("Flash");this.qtDetected=this.flower_utility.detectPluginOrAxo("QuickTime");this.ismobile=this.flower_utility.checkForMobile();this.addKeyEvents();},attachToElement:function(a){if(!this.ismobile){var f=a.getProperty("href"),b=f.toLowerCase(),d=a.getProperty("title"),e=a.getProperty("rev"),h=this.renderboxwidth,c=this.renderboxheight,i=false,g;if(e){if(e.contains("moviebox:")){$A(e.substring(9,e.length).split(",")).each(function(k){var j=k.split("=");switch(j[0]){case"width":if(j[1]){h=j[1];}break;case"height":if(j[1]){c=j[1];}break;}});}}if((b.contains(".mov")||b.contains(".mp4"))&&this.qtDetected){i="qt";if(this.options.showcontrols=="true"){c+=16;}}else{if(b.contains("youtube.com/watch?v=")){i="yt";c=(h*0.5625).round()+25;}else{if(b.test(/vimeo.com\/\d/)){i="vm";}else{if(b.contains("vevo.com/watch")&&this.flashDetected){i="vv";}}}}if(i){a.removeEvents("click");a.addEvent("click",function(j){this.showMovie(i,d,f,h,c);j.stop();}.bind(this));}}},showMovie:function(e,a,c,b,d){this.movieType=e;this.caption=a;this.movieurl=c;this.renderboxwidth=b;this.renderboxheight=d;if(this.state==0){this.createDomElements();this.overlayCloseLink.set("html","close <small>[esc]</small>");this.state=1;}this.showOverlay();},showOverlay:function(){if(this.state==1){if(window.flowerUID){var a=flowerUID.getModule("soundplayer");if(a){a.pauseCurrentSound();}}this.parent();}},showContent:function(){if(this.movieType=="qt"){if(Browser.Engine.trident){this.overlayContentSpc.set("html",'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" standby="loading quicktime..." codebase="http://www.apple.com/qtactivex/qtplugin.cab" width="'+this.renderboxwidth+'" height="'+this.renderboxheight+'" id="'+this.options.movieObjectID+'"><param name="src" value="'+this.movieurl+'" /><param name="scale" value="aspect" /><param name="controller" value="'+this.options.showcontrols+'" /><param name="cache" value="false" /><param name="autoplay" value="true" /><param name="bgcolor" value="'+this.options.contentspcbg+'" /><param name="enablejavascript" value="true" /></object>');
}else{this.overlayContentSpc.set("html",'<object id="'+this.options.movieObjectID+'" standby="loading quicktime..." type="video/quicktime" codebase="http://www.apple.com/qtactivex/qtplugin.cab" data="'+this.movieurl+'" width="'+this.renderboxwidth+'" height="'+this.renderboxheight+'"><param name="src" value="'+this.movieurl+'" /><param name="scale" value="aspect" /><param name="controller" value="'+this.options.showcontrols+'" /><param name="cache" value="false" /><param name="autoplay" value="true" /><param name="bgcolor" value="'+this.options.contentspcbg+'" /><param name="enablejavascript" value="true" /></object>');}this.currentMovie=document.getElementById(this.options.movieObjectID);(function(){this.state=11;}.bind(this)).delay(1200);}else{if(this.movieType=="yt"||this.movieType=="vm"){var a=this.parseVideoURL(this.movieurl);this.overlayContentSpc.set("html",'<iframe src="'+a+'" width="'+this.renderboxwidth+'" height="'+this.renderboxheight+'" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe>');this.currentMovie=document.id(this.options.movieObjectID);this.state=11;}else{if(this.movieType=="vv"){var a=this.parseVideoURL(this.movieurl);this.overlayContentSpc.set("html",'<object id="'+this.options.movieObjectID+'" standby="loading video..." type="application/x-shockwave-flash" width="'+this.renderboxwidth+'" height="'+this.renderboxheight+'" data="'+a+'"><param name="movie" value="'+a+'" /><param name="bgcolor" value="'+this.options.contentspcbg+'" /><param name="allowFullScreen" value="true" /><param name="wmode" value="window" /><param name="allowScriptAccess" value="always" /></object>');this.currentMovie=document.id(this.options.movieObjectID);this.state=11;}}}this.positionCaption();this.fireEvent("videoCreated",this.currentMovie);},parseVideoURL:function(c){var d=false,a=c.toLowerCase(),b;if(a.contains("youtube.com/watch?v=")){d=c.replace(/watch\?v\=/i,"embed/");b=d.indexOf("&");if(b>-1){d=d.substr(0,b);}d+="?autoplay=1&amp;rel=0&amp;hd=1";}else{if(a.contains("vimeo.com/")){cleanedUrl=this.movieurl.replace("www.","");
d=cleanedUrl.replace("vimeo.com/","player.vimeo.com/video/");d+="?title=1&amp;byline=1&amp;portrait=1&amp;autoplay=1";}else{if(a.contains("vevo.com/watch")){d="http://www.vevo.com/VideoPlayer/Embedded?videoId=";b=a.lastIndexOf("/")+1;d+=a.substr(b,a.length-b);d+="&autoplay=1&playerType=embedded&playlist=false";}}}return d;},hideOverlay:function(){if(this.state==11){if(this.movieType=="qt"){if(Browser.Engine.webkit||Browser.Engine.trident){this.currentMovie.Stop();this.currentMovie.style.display="none";}}else{if(!Browser.Engine.trident&&this.movieType=="vv"){this.currentMovie.dispose();}}this.currentMovie=null;this.overlayContentSpc.set("html","");this.movieType=false;this.parent();this.state=1;}}});window.addEvent("domready",function(){if(typeof(flowerUID)=="object"){flowerUID.registerModule(FlowerMoviebox,"moviebox");}else{var a=new FlowerMoviebox();$$("a[href$=.mov],a[href$=.mp4],a[href$=.MOV],a[href$=.MP4],a[href^=http://www.youtube.com/watch?v],a[href^=http://youtube.com/watch?v],a[href^=http://vimeo.com/],a[href^=http://www.vimeo.com/],a[href^=http://www.youtube.com/watch?v]").each(function(b){a.attachToElement(b);});}});